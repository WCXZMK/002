<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="äº¤äº’å¼çƒŸèŠ±è¡¨æ¼”ç½‘ç«™ - ç‚¹å‡»å±å¹•å‘å°„ç»šçƒ‚çƒŸèŠ±">
    <meta name="keywords" content="çƒŸèŠ±, äº¤äº’å¼, åŠ¨ç”», éŸ³æ•ˆ, èŠ‚æ—¥">
    <meta name="author" content="çƒŸèŠ±ç»½æ”¾ç½‘ç«™">
    <meta property="og:title" content="ğŸ† çƒŸèŠ±ç»½æ”¾">
    <meta property="og:description" content="ä½“éªŒç»šçƒ‚çš„äº¤äº’å¼çƒŸèŠ±è¡¨æ¼”">
    <meta property="og:type" content="website">
    <title>ğŸ† çƒŸèŠ±ç»½æ”¾ | äº¤äº’å¼çƒŸèŠ±è¡¨æ¼”</title>
    
    <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
    <link rel="preload" href="1.jpg" as="image">
    <link rel="preload" href="1.mp3" as="audio">
    
    <link rel="stylesheet" href="style.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            background: #000;
            overflow: hidden;
            font-family: 'åæ–‡è¡Œæ¥·', 'STXingkai', 'æ¥·ä½“', 'KaiTi', serif;
            touch-action: none; /* é˜²æ­¢ç§»åŠ¨ç«¯åŒå‡»ç¼©æ”¾ */
            user-select: none; /* é˜²æ­¢æ–‡æœ¬é€‰æ‹© */
        }
        
        /* èƒŒæ™¯å›¾ç‰‡æ ·å¼ */
        body {
            background-image: url('1.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        
        canvas {
            display: block;
            cursor: crosshair;
            background: transparent;
            touch-action: none; /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 24px;
            z-index: 1000;
        }
        
        .hint-text {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 28px;
            text-shadow: 0 0 10px #fff, 0 0 20px #ff0, 0 0 30px #f80;
            pointer-events: none;
            animation: glow 2s ease-in-out infinite alternate;
            z-index: 10;
            white-space: nowrap;
            opacity: 0;
            animation: glow 2s ease-in-out infinite alternate, fadeIn 1s ease-in-out 2s forwards;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 10px #fff, 0 0 20px #ff0, 0 0 30px #f80; }
            to { text-shadow: 0 0 20px #fff, 0 0 30px #ff0, 0 0 40px #f80, 0 0 50px #f40; }
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .hint-text {
                font-size: 20px;
                top: 15px;
            }
        }
        
        /* æ€§èƒ½ä¼˜åŒ–æç¤º */
        .performance-hint {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            animation: fadeIn 1s ease-in-out 4s forwards;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">ğŸ† çƒŸèŠ±åŠ è½½ä¸­...</div>
    <canvas id="cvs"></canvas>
    <div class="hint-text">ç‚¹å‡»å±å¹•å‘å°„çƒŸèŠ± ğŸ†</div>
    <div class="performance-hint">æç¤ºï¼šç‚¹å‡»ä»»æ„ä½ç½®å‘å°„çƒŸèŠ±</div>
    
    <!-- æ ¸å¿ƒæ¨¡å— -->
    <script src="config.js"></script>
    <script src="entities.js"></script>
    <script src="music.js"></script>
    <script src="filemanager.js"></script>
    <script src="fireworks.js"></script>
    <script src="ui.js"></script>
    
    <script>
    // æ€§èƒ½ä¼˜åŒ–é…ç½®
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    // ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ–
    if (isMobile) {
        // å‡å°‘ç²’å­æ•°é‡
        FireworksConfig.particleCount = 40;
        FireworksConfig.autoLaunchInterval = 800;
    }
    
    // è®¾ç½®é»˜è®¤é…ç½®
    FireworksConfig.music.tracks = [{
        name: 'èŠ‚æ—¥èƒŒæ™¯éŸ³ä¹',
        url: '1.mp3',
        loop: true
    }];
    FireworksConfig.music.enabled = true;
    FireworksConfig.music.volume = 0.3;
    
    // åˆå§‹åŒ–åº”ç”¨
    let fireworksApp;
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.addEventListener('load', function() {
        try {
            fireworksApp = new FireworksApp();
            
            // éšè—åŠ è½½æç¤º
            setTimeout(() => {
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.style.display = 'none';
                }
            }, 1000);
            
        } catch (error) {
            console.error('çƒŸèŠ±åˆå§‹åŒ–å¤±è´¥:', error);
            const loading = document.getElementById('loading');
            if (loading) {
                loading.textContent = 'âŒ åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•';
                loading.style.color = '#ff6b6b';
            }
        }
    });
    
    // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
    document.addEventListener('visibilitychange', function() {
        if (fireworksApp && fireworksApp.musicManager) {
            if (document.hidden) {
                // é¡µé¢éšè—æ—¶æš‚åœéŸ³ä¹
                fireworksApp.musicManager.pause();
            } else {
                // é¡µé¢æ˜¾ç¤ºæ—¶æ¢å¤éŸ³ä¹
                fireworksApp.musicManager.play();
            }
        }
    });
    
    // é”™è¯¯å¤„ç†
    window.addEventListener('error', function(e) {
        console.error('é¡µé¢é”™è¯¯:', e.error);
        if (e.message.includes('Audio')) {
            // éŸ³é¢‘ç›¸å…³é”™è¯¯å¤„ç†
            console.warn('éŸ³é¢‘æ’­æ”¾å¯èƒ½éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½å¼€å§‹');
        }
    });
    
    // æ€§èƒ½ç›‘æ§
    let lastFrameTime = performance.now();
    let frameCount = 0;
    
    function monitorPerformance() {
        const currentTime = performance.now();
        frameCount++;
        
        if (currentTime - lastFrameTime >= 1000) {
            const fps = Math.round((frameCount * 1000) / (currentTime - lastFrameTime));
            
            // å¦‚æœå¸§ç‡è¿‡ä½ï¼Œé™ä½æ•ˆæœ
            if (fps < 20 && fireworksApp) {
                console.log('æ€§èƒ½ä¼˜åŒ–ï¼šé™ä½çƒŸèŠ±æ•ˆæœä»¥ä¿æŒæµç•…æ€§');
                // è¿™é‡Œå¯ä»¥æ·»åŠ æ€§èƒ½é™çº§é€»è¾‘
            }
            
            frameCount = 0;
            lastFrameTime = currentTime;
        }
        
        requestAnimationFrame(monitorPerformance);
    }
    
    // å¯åŠ¨æ€§èƒ½ç›‘æ§
    requestAnimationFrame(monitorPerformance);
    </script>
</body>
</html>